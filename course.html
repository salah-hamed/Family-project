<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ±Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© - KidsUp</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .progress-container {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .mode-toggle {
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .mode-toggle.active {
            background: #4CAF50;
            color: white;
        }

        .lessons-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .lesson-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .lesson-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .lesson-card.completed::before,
        .lesson-card:hover::before {
            transform: scaleX(1);
        }

        .lesson-card.completed {
            border-left: 5px solid #4CAF50;
        }

        .lesson-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .lesson-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .lesson-card p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .lesson-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
        }

        .status-dot.completed {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-btn {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .nav-btn.prev {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .nav-btn.next {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .certificate-btn {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
            margin: 20px auto;
            display: block;
        }

        .certificate-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255,107,107,0.6);
        }

        .certificate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .demo-notice {
            background: rgba(255,193,7,0.2);
            border: 2px solid rgba(255,193,7,0.5);
            color: #856404;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-info {
            background: rgba(52,152,219,0.1);
            border: 1px solid rgba(52,152,219,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .lessons-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .navigation {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            padding: 50px;
        }

        .error {
            background: rgba(231,76,60,0.2);
            border: 1px solid rgba(231,76,60,0.5);
            color: #c0392b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Ø¯ÙˆØ±Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</h1>
            <p>Ø§ÙƒØªØ´Ù Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©!</p>
        </div>

        <div id="statusInfo" class="status-info" style="display: none;"></div>
        <div id="demoNotice" class="demo-notice" style="display: none;">
            ğŸ“± ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ Ù…ÙØ¹Ù„ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ©
        </div>
        <div id="errorMsg" class="error" style="display: none;"></div>

        <div class="progress-container">
            <div>Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø©: <span id="progressPercent">0%</span></div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div>Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: <span id="completedCount">0</span> Ù…Ù† <span id="totalLessons">10</span></div>
            <button id="modeToggle" class="mode-toggle">ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ</button>
        </div>

        <div class="navigation">
            <button id="prevBtn" class="nav-btn prev">
                â† Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ù‚
            </button>
            <button id="nextBtn" class="nav-btn next">
                Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ â†’
            </button>
        </div>

        <div id="lessonsContainer" class="lessons-container"></div>

        <button id="certificateBtn" class="certificate-btn" style="display: none;" disabled>
            ğŸ† ØªØ­Ù…ÙŠÙ„ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥ØªÙ…Ø§Ù…
        </button>

        <div id="loading" class="loading" style="display: none;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø©...</div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyB...YOUR_API_KEY...",
            authDomain: "kidsup-e998d.firebaseapp.com",
            projectId: "kidsup-e998d",
            storageBucket: "kidsup-e998d.appspot.com",
            messagingSenderId: "959800471628",
            appId: "1:959800471628:web:YOUR_APP_ID"
        };

        // Global state
        let lessons = [];
        let currentLessonIndex = 0;
        let isDemoMode = true;
        let db = null;
        let userId = null;
        let unsubscribeProgress = null;

        // Lessons data (syntax error fixed - proper array)
        const lessonData = [
            {
                id: 1,
                title: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…!",
                description: "ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© ÙˆØ§ÙƒØªØ¨ Ø£ÙˆÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„Ùƒ",
                content: "```javascript
console.log('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…!');
// Ù‡Ø°Ø§ Ø£ÙˆÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ Ø­ÙŠØ§ØªÙƒ!
```",
                completed: false
            },
            {
                id: 2,
                title: "Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª",
                description: "ØªØ¹Ù„Ù… ÙƒÙŠÙÙŠØ© Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª",
                content: "```javascript
let name = 'Ø£Ø­Ù…Ø¯';
let age = 12;
console.log(`Ø§Ø³Ù…ÙŠ ${name} ÙˆØ¹Ù…Ø±ÙŠ ${age}`);
```",
                completed: false
            },
            {
                id: 3,
                title: "Ø§Ù„Ø¯ÙˆØ§Ù„",
                description: "Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡",
                content: "```javascript
function sayHello(name) {
    console.log(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}!`);
}
sayHello('Ø³Ø§Ø±Ø©');
```",
                completed: false
            },
            {
                id: 4,
                title: "Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©",
                description: "Ø§ØªØ®Ø° Ù‚Ø±Ø§Ø±Ø§Øª ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬Ùƒ",
                content: "```javascript
let score = 85;
if (score >= 90) {
    console.log('Ù…Ù…ØªØ§Ø²!');
} else {
    console.log('Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹');
}
```",
                completed: false
            },
            {
                id: 5,
                title: "Ø§Ù„Ø­Ù„Ù‚Ø§Øª",
                description: "ÙƒØ±Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",
                content: "```javascript
for (let i = 1; i <= 5; i++) {
    console.log(`Ø§Ù„Ø±Ù‚Ù… ${i}`);
}
```",
                completed: false
            },
            {
                id: 6,
                title: "Ø§Ù„Ù…ØµÙÙˆÙØ§Øª",
                description: "Ø§Ø­ÙØ¸ Ù‚ÙˆØ§Ø¦Ù… Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                content: "```javascript
let fruits = ['ØªÙØ§Ø­', 'Ù…ÙˆØ²', 'Ø¨Ø±ØªÙ‚Ø§Ù„'];
fruits.forEach(fruit => {
    console.log(`Ø£Ø­Ø¨ ${fruit}`);
});
```",
                completed: false
            },
            {
                id: 7,
                title: "Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª",
                description: "Ù†Ø¸Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„",
                content: "```javascript
let student = {
    name: 'Ù…Ø­Ù…Ø¯',
    age: 14,
    grade: 'Ø£'
};
console.log(student.name);
```",
                completed: false
            },
            {
                id: 8,
                title: "Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",
                description: "Ø§Ø¬Ø¹Ù„ Ø¨Ø±Ù†Ø§Ù…Ø¬Ùƒ ØªÙØ§Ø¹Ù„ÙŠØ§Ù‹",
                content: "```javascript
document.getElementById('btn').addEventListener('click', () => {
    alert('ØªÙ… Ø§Ù„Ø¶ØºØ·!');
});
```",
                completed: false
            },
            {
                id: 9,
                title: "DOM Manipulation",
                description: "ØªØºÙŠÙŠØ± ØµÙØ­Ø© Ø§Ù„ÙˆÙŠØ¨ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹",
                content: "```javascript
document.getElementById('title').innerHTML = 'Ù…Ø±Ø­Ø¨Ø§Ù‹!'
document.getElementById('title').style.color = 'blue';
```",
                completed: false
            },
            {
                id: 10,
                title: "Ù…Ø´Ø±ÙˆØ¹ Ù†Ù‡Ø§Ø¦ÙŠ",
                description: "Ø¨Ù†Ø§Ø¡ Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© ÙƒØ§Ù…Ù„Ø©",
                content: "```javascript
// Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© ÙƒØ§Ù…Ù„Ø©
function calculator(a, b, operation) {
    switch(operation) {
        case '+': return a + b;
        case '-': return a - b;
        // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
    }
}
```",
                completed: false
            }
        ];

        // Initialize app
        async function initApp() {
            try {
                // Initialize Firebase if config is valid
                if (firebaseConfig.apiKey && firebaseConfig.apiKey !== "AIzaSyB...YOUR_API_KEY...") {
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    
                    try {
                        await firebase.auth().signInAnonymously();
                        firebase.auth().onAuthStateChanged(async (user) => {
                            if (user) {
                                userId = user.uid;
                                isDemoMode = false;
                                await loadProgress();
                                updateUI();
                            }
                        });
                    } catch (authError) {
                        console.warn('Auth failed, using demo mode:', authError);
                        isDemoMode = true;
                    }
                } else {
                    console.log('Firebase config incomplete, using demo mode');
                    isDemoMode = true;
                }

                lessons = [...lessonData];
                renderLessons();
                updateProgress();
                setupEventListeners();
                
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error('Init error:', error);
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ' + error.message);
                lessons = [...lessonData];
                renderLessons();
                updateProgress();
                setupEventListeners();
                document.getElementById('loading').style.display = 'none';
            }
        }

        function setupEventListeners() {
            // Mode toggle
            document.getElementById('modeToggle').addEventListener('click', toggleMode);

            // Navigation
            document.getElementById('prevBtn').addEventListener('click', prevLesson);
            document.getElementById('nextBtn').addEventListener('click', nextLesson);

            // Certificate
            document.getElementById('certificateBtn').addEventListener('click', generateCertificate);
        }

        function toggleMode() {
            isDemoMode = !isDemoMode;
            const toggleBtn = document.getElementById('modeToggle');
            
            if (isDemoMode) {
                toggleBtn.textContent = 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ';
                toggleBtn.classList.remove('active');
                document.getElementById('demoNotice').style.display = 'block';
                // Reset progress for demo
                lessons.forEach(lesson => lesson.completed = false);
            } else {
                toggleBtn.textContent = 'ÙˆØ¶Ø¹ Firebase';
                toggleBtn.classList.add('active');
                document.getElementById('demoNotice').style.display = 'none';
                loadProgress();
            }
            
            renderLessons();
            updateProgress();
            updateStatusInfo();
        }

        async function loadProgress() {
            if (isDemoMode || !db || !userId) {
                return;
            }

            try {
                const userRef = db.collection('users').doc(userId);
                const doc = await userRef.get();
                
                if (doc.exists && doc.data().courseActive) {
                    const progress = doc.data().progress || {};
                    lessons.forEach(lesson => {
                        lesson.completed = progress[lesson.id] || false;
                    });
                    currentLessonIndex = progress.currentLesson || 0;
                }
            } catch (error) {
                console.error('Load progress error:', error);
                // Create collection with proper permissions if needed
                await ensureFirestorePermissions();
            }
        }

        async function saveProgress() {
            if (isDemoMode || !db || !userId) {
                localStorage.setItem('courseProgress', JSON.stringify({
                    lessons: lessons.map(l => ({id: l.id, completed: l.completed})),
                    currentLessonIndex
                }));
                return;
            }

            try {
                await db.collection('users').doc(userId).set({
                    courseActive: true,
                    progress: lessons.reduce((acc, lesson) => {
                        acc[lesson.id] = lesson.completed;
                        return acc;
                    }, {}),
                    currentLessonIndex,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    completedLessons: lessons.filter(l => l.completed).length
                }, { merge: true });
            } catch (error) {
                console.error('Save progress error:', error);
                localStorage.setItem('courseProgress', JSON.stringify({
                    lessons: lessons.map(l => ({id: l.id, completed: l.completed})),
                    currentLessonIndex
                }));
            }
        }

        async function ensureFirestorePermissions() {
            if (!db || !userId) return;
            
            try {
                // This creates the document if it doesn't exist with proper permissions
                await db.collection('users').doc(userId).set({
                    courseActive: true,
                    progress: {},
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            } catch (error) {
                console.error('Permissions setup error:', error);
            }
        }

        function renderLessons() {
            const container = document.getElementById('lessonsContainer');
            container.innerHTML = lessons.map((lesson, index) => `
                <div class="lesson-card ${lesson.completed ? 'completed' : ''}" 
                     onclick="openLesson(${index})">
                    <div class="lesson-number">${lesson.id}</div>
                    <h3>${lesson.title}</h3>
                    <p>${lesson.description}</p>
                    <div class="lesson-status">
                        <div class="status-dot ${lesson.completed ? 'completed' : ''}"></div>
                        <span>${lesson.completed ? 'Ù…ÙƒØªÙ…Ù„ âœ…' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©'}</span>
                    </div>
                </div>
            `).join('');
        }

        function openLesson(index) {
            currentLessonIndex = index;
            // Simulate lesson view (in real app, show modal/content)
            lessons[index].completed = true;
            saveProgress();
            renderLessons();
            updateProgress();
            updateNavigation();
        }

        function prevLesson() {
            if (currentLessonIndex > 0) {
                currentLessonIndex--;
                updateNavigation();
            }
        }

        function nextLesson() {
            if (currentLessonIndex < lessons.length - 1) {
                currentLessonIndex++;
                // Auto-complete current lesson
                lessons[currentLessonIndex - 1].completed = true;
                saveProgress();
                renderLessons();
                updateProgress();
                updateNavigation();
            }
        }

        function updateProgress() {
            const completed = lessons.filter(l => l.completed).length;
            const total = lessons.length;
            const percentage = Math.round((completed / total) * 100);

            document.getElementById('progressPercent').textContent = percentage + '%';
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalLessons').textContent = total;
            document.getElementById('progressFill').style.width = percentage + '%';

            // Show certificate button if course completed
            const certificateBtn = document.getElementById('certificateBtn');
            if (percentage === 100) {
                certificateBtn.style.display = 'block';
                certificateBtn.disabled = false;
            } else {
                certificateBtn.style.display = 'none';
            }
        }

        function updateNavigation() {
            document.getElementById('prevBtn').disabled = currentLessonIndex === 0;
            document.getElementById('nextBtn').disabled = currentLessonIndex === lessons.length - 1;
        }

        function updateStatusInfo() {
            const statusInfo = document.getElementById('statusInfo');
            if (isDemoMode) {
                statusInfo.style.display = 'none';
            } else {
                statusInfo.style.display = 'block';
                statusInfo.innerHTML = `
                    âœ… Ù…ØªØµÙ„ Ø¨Ù€ Firebase<br>
                    ğŸ‘¤ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userId?.substring(0,8)}...<br>
                    ğŸ’¾ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ù…ÙØ¹Ù„
                `;
            }
        }

        function generateCertificate() {
            if (lessons.some(l => !l.completed)) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Arabic font support (using built-in)
            doc.setFont("helvetica");
            doc.setFontSize(20);
            doc.text('ğŸ† Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙˆØ±Ø©', 105, 30, { align: 'center' });
            
            doc.setFontSize(14);
            doc.text('ØªÙ… Ù…Ù†Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù€', 105, 60, { align: 'center' });
            doc.setFontSize(18);
            doc.text(userId ? `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId.substring(0,8)}` : 'Ø§Ù„Ù…ØªØ¯Ø±Ø¨ Ø§Ù„Ù…ØªÙ…ÙŠØ²', 105, 80, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text('Ø¨Ø¥ØªÙ…Ø§Ù… Ø¯ÙˆØ±Ø© "ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù…Ù† Ø§Ù„ØµÙØ±"', 105, 110, { align: 'center' });
            doc.text('Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø±ÙˆØ³: 10 Ø¯Ø±ÙˆØ³', 105, 125, { align: 'center' });
            doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØªÙ…Ø§Ù…: ${new Date().toLocaleDateString('ar-EG')}`, 105, 140, { align: 'center' });
            
            // KidsUp branding
            doc.setFontSize(10);
            doc.text('ØµØ§Ø¯Ø± Ø¹Ù† Ù…Ù†ØµØ© KidsUp Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©', 105, 170, { align: 'center' });
            doc.text('www.kidsup.com', 105, 180, { align: 'center' });
            
            // Signature line
            doc.line(50, 200, 160, 200);
            doc.text('Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©', 105, 210, { align: 'center' });
            
            doc.save('certificate-kidsup-programming.pdf');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Load localStorage fallback for demo mode
        function loadLocalProgress() {
            const saved = localStorage.getItem('courseProgress');
            if (saved) {
                const progress = JSON.parse(saved);
                lessons.forEach(lesson => {
                    const savedLesson = progress.lessons.find(l => l.id === lesson.id);
                    if (savedLesson) lesson.completed = savedLesson.completed;
                });
                currentLessonIndex = progress.currentLessonIndex || 0;
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            loadLocalProgress();
            initApp();
        });

        // Save progress periodically
        setInterval(saveProgress, 30000); // Every 30 seconds
    </script>
</body>
</html>
