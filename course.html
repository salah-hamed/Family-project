<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ±Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© - KidsUp</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .progress-container {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .mode-toggle {
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .mode-toggle.active {
            background: #4CAF50;
            color: white;
        }

        /* Navigation Section */
        .navigation {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-btn {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .nav-btn.prev {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .nav-btn.next {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Current Lesson Display - Ø§Ù„Ø£ÙØ¶Ù„ Ù„Ù„Ù…ØªØ¹Ù„Ù… */
        .current-lesson {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .lesson-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .lesson-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            margin: 0 auto 15px;
        }

        .lesson-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
        }

        .lesson-description {
            font-size: 1.1rem;
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }

        .lesson-content {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #4CAF50;
        }

        .lesson-content h4 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        pre {
            background: #2d3748;
            color: #a0aec0;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
            direction: ltr;
            text-align: left;
            margin-top: 15px;
        }

        .complete-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            display: block;
            margin-left: auto;
        }

        /* Lessons Grid */
        .lessons-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .lesson-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .lesson-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .lesson-card.completed::before,
        .lesson-card:hover::before,
        .lesson-card.current::before {
            transform: scaleX(1);
        }

        .lesson-card.completed {
            border-left: 5px solid #4CAF50;
        }

        .lesson-card.current {
            border-left: 5px solid #FF6B6B;
            transform: scale(1.02);
        }

        .card-lesson-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .lesson-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .lesson-card p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .certificate-btn {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
            margin: 20px auto;
            display: block;
        }

        .certificate-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255,107,107,0.6);
        }

        .demo-notice, .status-info {
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .demo-notice {
            background: rgba(255,193,7,0.2);
            border: 2px solid rgba(255,193,7,0.5);
            color: #856404;
        }

        .status-info {
            background: rgba(52,152,219,0.1);
            border: 1px solid rgba(52,152,219,0.3);
            color: #2980b9;
            font-weight: 500;
        }

        .error {
            background: rgba(231,76,60,0.2);
            border: 1px solid rgba(231,76,60,0.5);
            color: #c0392b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2rem; }
            .navigation { flex-direction: column; }
            .nav-btn { width: 100%; }
            .lesson-title { font-size: 1.6rem; }
            pre { font-size: 12px; padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Ø¯ÙˆØ±Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</h1>
            <p>Ø§ÙƒØªØ´Ù Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©!</p>
        </div>

        <div id="statusInfo" class="status-info" style="display: none;"></div>
        <div id="demoNotice" class="demo-notice" style="display: none;">
            ğŸ“± ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ Ù…ÙØ¹Ù„ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ©
        </div>
        <div id="errorMsg" class="error" style="display: none;"></div>

        <div class="progress-container">
            <div>Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø©: <span id="progressPercent">0%</span></div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div>Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="currentLessonNum">1</span> Ù…Ù† <span id="totalLessons">10</span></div>
            <button id="modeToggle" class="mode-toggle">ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ</button>
        </div>

        <!-- Navigation Buttons -->
        <div class="navigation">
            <button id="prevBtn" class="nav-btn prev" disabled>
                â† Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ù‚
            </button>
            <button id="nextBtn" class="nav-btn next">
                Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ â†’
            </button>
        </div>

        <!-- Current Lesson Content - Ø§Ù„Ø£ÙØ¶Ù„ Ù„Ù„Ù…ØªØ¹Ù„Ù… -->
        <div id="currentLesson" class="current-lesson" style="display: none;">
            <div class="lesson-header">
                <div id="lessonNumber" class="lesson-number"></div>
                <h2 id="lessonTitle" class="lesson-title"></h2>
                <p id="lessonDesc" class="lesson-description"></p>
            </div>
            <div class="lesson-content">
                <h4>ğŸ“ Ø¬Ø±Ø¨ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯:</h4>
                <pre id="lessonCode"></pre>
                <button id="completeBtn" class="complete-btn">âœ… Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³</button>
            </div>
        </div>

        <!-- Lessons Grid -->
        <h3 style="color: white; text-align: center; margin-bottom: 20px;">Ø¬Ù…ÙŠØ¹ Ø¯Ø±ÙˆØ³ Ø§Ù„Ø¯ÙˆØ±Ø©</h3>
        <div id="lessonsContainer" class="lessons-container"></div>

        <button id="certificateBtn" class="certificate-btn" style="display: none;" disabled>
            ğŸ† ØªØ­Ù…ÙŠÙ„ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥ØªÙ…Ø§Ù…
        </button>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyB...YOUR_API_KEY...",
            authDomain: "kidsup-e998d.firebaseapp.com",
            projectId: "kidsup-e998d",
            storageBucket: "kidsup-e998d.appspot.com",
            messagingSenderId: "959800471628",
            appId: "1:959800471628:web:YOUR_APP_ID"
        };

        // Global state
        let lessons = [];
        let currentLessonIndex = 0;
        let isDemoMode = true;
        let db = null;
        let userId = null;

        // Lessons data Ù…Ø¹ Ù…Ø­ØªÙˆÙ‰ ÙƒØ§Ù…Ù„
        const lessonData = [
            {
                id: 1, title: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…!", description: "Ø£ÙˆÙ„ Ø®Ø·ÙˆØ© ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© - Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±",
                content: `console.log('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…! ğŸ‘‹');
// Ù‡Ø°Ø§ Ø£ÙˆÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ Ø­ÙŠØ§ØªÙƒ!
// console.log ØªØ¹Ù†ÙŠ "Ø§Ø·Ø¨Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ"`
            },
            {
                id: 2, title: "Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª", description: "Ø§Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© ÙÙŠ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø±Ù‚Ù…ÙŠØ©",
                content: `let name = 'Ø£Ø­Ù…Ø¯';
let age = 12;
let city = 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©';

console.log(`Ø§Ø³Ù…ÙŠ ${name} ÙˆØ¹Ù…Ø±ÙŠ ${age} Ø³Ù†Ø© Ù…Ù† ${city}`);`
            },
            {
                id: 3, title: "Ø§Ù„Ø¯ÙˆØ§Ù„", description: "Ø§ØµÙ†Ø¹ Ø£Ø¯ÙˆØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…",
                content: `function sayHello(name) {
    console.log(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ ${name}! ğŸ‰`);
}

sayHello('Ø³Ø§Ø±Ø©');
sayHello('Ù…Ø­Ù…Ø¯');`
            },
            {
                id: 4, title: "Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©", description: "Ø¯Ø¹ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠØªØ®Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ©",
                content: `let score = 85;

if (score >= 90) {
    console.log('Ù…Ù…ØªØ§Ø²! â­');
} else if (score >= 70) {
    console.log('Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ ğŸ‘');
} else {
    console.log('ÙŠØ­ØªØ§Ø¬ ØªØ¯Ø±ÙŠØ¨ Ø£ÙƒØ«Ø± ğŸ“š');
}`
            },
            {
                id: 5, title: "Ø§Ù„Ø­Ù„Ù‚Ø§Øª", description: "ÙƒØ±Ù‘Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ø±Ø§Øª Ø¨Ø¶ØºØ·Ø© ÙˆØ§Ø­Ø¯Ø©",
                content: `for (let i = 1; i <= 5; i++) {
    console.log(`Ø§Ù„Ø±Ù‚Ù… ${i}: Ù…Ø±Ø­Ø¨Ø§Ù‹!`);
}

// Ø³ØªÙ†ÙÙ‘Ø° 5 Ù…Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹!`
            },
            {
                id: 6, title: "Ø§Ù„Ù…ØµÙÙˆÙØ§Øª", description: "Ø§Ø­ÙØ¸ Ù‚ÙˆØ§Ø¦Ù… ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                content: `let fruits = ['ØªÙØ§Ø­', 'Ù…ÙˆØ²', 'Ø¨Ø±ØªÙ‚Ø§Ù„', 'Ù…Ø§Ù†Ø¬Ùˆ'];

fruits.forEach((fruit, index) => {
    console.log(`Ø§Ù„ÙØ§ÙƒÙ‡Ø© Ø±Ù‚Ù… ${index + 1}: ${fruit}`);
});`
            },
            {
                id: 7, title: "Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª", description: "Ù†Ø¸Ù‘Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ ÙÙŠ Ù‡ÙŠÙƒÙ„ Ù…Ù†Ø¸Ù…",
                content: `let student = {
    name: 'ÙØ§Ø·Ù…Ø©',
    age: 14,
    grade: 'Ø£',
    subjects: ['Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ø¹Ù„ÙˆÙ…']
};

console.log(`Ø§Ù„Ø·Ø§Ù„Ø¨Ø© ${student.name} Ø¯Ø±Ø¬ØªÙ‡Ø§ ${student.grade}`);`
            },
            {
                id: 8, title: "Ø§Ù„Ø£Ø­Ø¯Ø§Ø«", description: "Ø§Ø¬Ø¹Ù„ ØµÙØ­ØªÙƒ ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø±",
                content: `// Ø¶Ø¹ Ù‡Ø°Ø§ ÙÙŠ HTML: <button id="myBtn">Ø§Ø¶ØºØ· Ù‡Ù†Ø§</button>

document.getElementById('myBtn').addEventListener('click', () => {
    alert('ØªÙ… Ø§Ù„Ø¶ØºØ·! ğŸŠ');
});`
            },
            {
                id: 9, title: "Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙØ­Ø©", description: "ØºÙŠÙ‘Ø± Ø´ÙƒÙ„ Ø§Ù„ØµÙØ­Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹",
                content: `// Ø¶Ø¹ ÙÙŠ HTML: <h1 id="title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£ØµÙ„ÙŠ</h1>

document.getElementById('title').innerHTML = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†! ğŸŒŸ';
document.getElementById('title').style.color = 'blue';
document.getElementById('title').style.fontSize = '2rem';`
            },
            {
                id: 10, title: "Ù…Ø´Ø±ÙˆØ¹ Ù†Ù‡Ø§Ø¦ÙŠ: Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©", description: "Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ø­Ù‚ÙŠÙ‚ÙŠ ÙƒØ§Ù…Ù„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù",
                content: `function calculator(num1, num2, operation) {
    switch(operation) {
        case '+': return num1 + num2;
        case '-': return num1 - num2;
        case '*': return num1 * num2;
        case '/': return num1 / num2;
        default: return 'Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
    }
}

console.log(calculator(10, 5, '+')); // 15`
            }
        ];

        // Initialize app
        async function initApp() {
            if (firebaseConfig.apiKey && firebaseConfig.apiKey !== "AIzaSyB...YOUR_API_KEY...") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                try {
                    await firebase.auth().signInAnonymously();
                    firebase.auth().onAuthStateChanged(async (user) => {
                        if (user) {
                            userId = user.uid;
                            isDemoMode = false;
                            await loadProgress();
                            updateUI();
                        }
                    });
                } catch (error) {
                    isDemoMode = true;
                }
            } else {
                isDemoMode = true;
            }

            lessons = lessonData.map(l => ({...l, completed: false}));
            renderLessons();
            showCurrentLesson();
            updateProgress();
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('modeToggle').addEventListener('click', toggleMode);
            document.getElementById('prevBtn').addEventListener('click', prevLesson);
            document.getElementById('nextBtn').addEventListener('click', nextLesson);
            document.getElementById('certificateBtn').addEventListener('click', generateCertificate);
            document.getElementById('completeBtn').addEventListener('click', completeCurrentLesson);
        }

        function toggleMode() {
            isDemoMode = !isDemoMode;
            const btn = document.getElementById('modeToggle');
            if (isDemoMode) {
                btn.textContent = 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ';
                btn.classList.remove('active');
                document.getElementById('demoNotice').style.display = 'block';
            } else {
                btn.textContent = 'ÙˆØ¶Ø¹ Firebase';
                btn.classList.add('active');
                document.getElementById('demoNotice').style.display = 'none';
                loadProgress();
            }
            updateUI();
        }

        async function loadProgress() {
            if (isDemoMode || !db || !userId) {
                loadLocalProgress();
                return;
            }
            try {
                const doc = await db.collection('users').doc(userId).get();
                if (doc.exists && doc.data().courseActive) {
                    const progress = doc.data().progress || {};
                    lessons.forEach(lesson => {
                        lesson.completed = progress[lesson.id] || false;
                    });
                    currentLessonIndex = progress.currentLesson || 0;
                }
            } catch (error) {
                console.error('Load error:', error);
            }
        }

        function loadLocalProgress() {
            const saved = localStorage.getItem('courseProgress');
            if (saved) {
                const data = JSON.parse(saved);
                lessons.forEach(l => l.completed = data.lessons[l.id] || false);
                currentLessonIndex = data.current || 0;
            }
        }

        async function saveProgress() {
            const progressData = {
                lessons: lessons.reduce((acc, l) => { acc[l.id] = l.completed; return acc; }, {}),
                currentLesson: currentLessonIndex,
                courseActive: true
            };

            if (isDemoMode || !db || !userId) {
                localStorage.setItem('courseProgress', JSON.stringify(progressData));
                return;
            }

            try {
                await db.collection('users').doc(userId).set(progressData, { merge: true });
            } catch (error) {
                localStorage.setItem('courseProgress', JSON.stringify(progressData));
            }
        }

        function renderLessons() {
            const container = document.getElementById('lessonsContainer');
            container.innerHTML = lessons.map((lesson, index) => `
                <div class="lesson-card ${lesson.completed ? 'completed' : ''} ${index === currentLessonIndex ? 'current' : ''}" 
                     onclick="goToLesson(${index})">
                    <div class="card-lesson-number">${lesson.id}</div>
                    <h3>${lesson.title}</h3>
                    <p>${lesson.description}</p>
                    <div style="color: #666; font-size: 14px;">
                        ${lesson.completed ? 'âœ… Ù…ÙƒØªÙ…Ù„' : index === currentLessonIndex ? 'ğŸ”¥ Ø§Ù„Ø­Ø§Ù„ÙŠ' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©'}
                    </div>
                </div>
            `).join('');
        }

        function showCurrentLesson() {
            const lesson = lessons[currentLessonIndex];
            if (!lesson) return;

            document.getElementById('currentLesson').style.display = 'block';
            document.getElementById('lessonNumber').textContent = lesson.id;
            document.getElementById('lessonTitle').textContent = lesson.title;
            document.getElementById('lessonDesc').textContent = lesson.description;
            document.getElementById('lessonCode').textContent = lesson.content;
            document.getElementById('currentLessonNum').textContent = lesson.id;

            // Scroll to current lesson
            document.getElementById('currentLesson').scrollIntoView({ behavior: 'smooth' });
        }

        function goToLesson(index) {
            currentLessonIndex = index;
            lessons[currentLessonIndex].completed = true;
            saveProgress();
            updateUI();
        }

        function prevLesson() {
            if (currentLessonIndex > 0) {
                currentLessonIndex--;
                updateUI();
            }
        }

        function nextLesson() {
            if (currentLessonIndex < lessons.length - 1) {
                currentLessonIndex++;
                updateUI();
            }
        }

        function completeCurrentLesson() {
            lessons[currentLessonIndex].completed = true;
            saveProgress();
            updateUI();
            alert('âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ');
        }

        function updateUI() {
            renderLessons();
            showCurrentLesson();
            updateProgress();
            updateNavigation();
            updateStatusInfo();
        }

        function updateProgress() {
            const completed = lessons.filter(l => l.completed).length;
            const total = lessons.length;
            const percentage = Math.round((completed / total) * 100);

            document.getElementById('progressPercent').textContent = percentage + '%';
            document.getElementById('totalLessons').textContent = total;
            document.getElementById('progressFill').style.width = percentage + '%';

            const certBtn = document.getElementById('certificateBtn');
            if (percentage === 100) {
                certBtn.style.display = 'block';
                certBtn.disabled = false;
            }
        }

        function updateNavigation() {
            document.getElementById('prevBtn').disabled = currentLessonIndex === 0;
            document.getElementById('nextBtn').disabled = currentLessonIndex === lessons.length - 1;
        }

        function updateStatusInfo() {
            const info = document.getElementById('statusInfo');
            if (isDemoMode) {
                info.style.display = 'none';
            } else {
                info.style.display = 'block';
                info.innerHTML = `âœ… Firebase Ù…ÙØ¹Ù‘Ù„ | ğŸ‘¤ ${userId?.substring(0,8)}... | ğŸ’¾ Ø³Ø­Ø§Ø¨ÙŠ`;
            }
        }

        function generateCertificate() {
            if (lessons.some(l => !l.completed)) return alert('Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø£ÙˆÙ„Ø§Ù‹!');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(24);
            doc.text('ğŸ† Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙˆØ±Ø©', 105, 40, { align: 'center' });
            doc.setFontSize(16);
            doc.text('Ø¯ÙˆØ±Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© - KidsUp', 105, 70, { align: 'center' });
            doc.text(`Ø§Ù„Ù…ØªØ¯Ø±Ù‘Ø¨: ${userId?.substring(0,12) || 'Ø§Ù„Ù†Ø¬ÙŠØ¨'}`, 105, 100, { align: 'center' });
            doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: ${new Date().toLocaleDateString('ar-EG')}`, 105, 120, { align: 'center' });
            doc.text('Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø±ÙˆØ³: 10 Ø¯Ø±ÙˆØ³ ÙƒØ§Ù…Ù„Ø©', 105, 140, { align: 'center' });
            doc.text('KidsUp Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©', 105, 200, { align: 'center' });
            
            doc.save('kidsup-programming-certificate.pdf');
        }

        function showError(msg) {
            const div = document.getElementById('errorMsg');
            div.textContent = msg;
            div.style.display = 'block';
            setTimeout(() => div.style.display = 'none', 5000);
        }

        // Init
        window.addEventListener('load', initApp);
        setInterval(saveProgress, 20000); // Save every 20s
    </script>
</body>
    </html>
