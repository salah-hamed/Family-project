<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† - Family Business</title>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
  <script src="app.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      min-height: 100vh; 
      color: #333;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .login-form { 
      background: white; border-radius: 20px; padding: 40px; max-width: 400px; margin: 100px auto; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
    }
    .dashboard { display: none; }
    h1 { background: linear-gradient(45deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin-bottom: 30px; }
    .card { background: white; border-radius: 15px; padding: 25px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .btn { 
      background: linear-gradient(45deg, #FF6B6B, #FF8E8E); color: white; border: none; padding: 12px 24px; 
      border-radius: 25px; cursor: pointer; font-size: 16px; transition: transform 0.2s; 
    }
    .btn:hover { transform: scale(1.05); }
    .btn-success { background: linear-gradient(45deg, #4CAF50, #81C784); }
    .btn-danger { background: linear-gradient(45deg, #F44336, #EF5350); }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { padding: 15px; text-align: right; border-bottom: 1px solid #ddd; }
    th { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
    input, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; margin: 10px 0; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    .stat-card { background: linear-gradient(45deg, #FFD700, #FFA500); color: white; padding: 20px; border-radius: 15px; text-align: center; }
    .logout { position: absolute; top: 20px; left: 20px; }
    @media (max-width: 768px) { .container { padding: 10px; } }
  </style>
</head>
<body>
  <div class="container">
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginScreen" class="login-form">
      <h1>ğŸ‰ Family Business Admin</h1>
      <input type="email" id="adminEmail" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: admin@familybusiness.com" />
      <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±: admin123456" />
      <button class="btn" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</button>
      <p style="text-align: center; margin-top: 20px; color: #666;">Ù…Ø­Ù…ÙŠ 100% Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†</p>
    </div>

    <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† -->
    <div id="adminDashboard" class="dashboard">
      <button class="btn logout" onclick="adminLogout()">Ø®Ø±ÙˆØ¬</button>
      
      <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Family Business ğŸš€</h1>
      
      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
      <div class="stats" id="stats"></div>
      
      <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
      <div class="card">
        <h2>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù…Ù† Firestore)</h2>
        <table id="usersTable">
          <thead><tr><th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th><th>ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³</th><th>Ø£Ø¯Ù…Ù†ØŸ</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      
      <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Demo -->
      <div class="card">
        <h2>â­ Ù…Ø´Ø§Ø±ÙŠØ¹ Demo (ØªØ¹Ø±Ø¶ ÙÙŠ index.html)</h2>
        <input id="projectTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" />
        <textarea id="projectDesc" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"></textarea>
        <input id="projectLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" />
        <button class="btn btn-success" onclick="addProject()">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</button>
        <table id="projectsTable">
          <thead><tr><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù†Ø¨Ø°Ø©</th><th>Ø§Ù„Ø±Ø§Ø¨Ø·</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† (Ù…Ø­Ù…ÙŠ Ø¨Ù€ Firebase Auth)
    async function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const pass = document.getElementById('adminPass').value;
      
      try {
        await firebase.auth().signInWithEmailAndPassword(email, pass);
        const user = firebase.auth().currentUser;
        if (user) {
          // ØªØ­Ù‚Ù‚ Ø¥Ù†Ù‡ Ø£Ø¯Ù…Ù† Ù…Ù† Firestore
          const doc = await firebase.firestore().collection('users').doc(user.uid).get();
          if (doc.exists && doc.data().isAdmin) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            loadDashboard();
          } else {
            alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ø¯Ù…Ù†!');
            firebase.auth().signOut();
          }
        }
      } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message);
      }
    }
    
    // Ø®Ø±ÙˆØ¬
    async function adminLogout() {
      await firebase.auth().signOut();
      document.getElementById('adminDashboard').style.display = 'none';
      document.getElementById('loginScreen').style.display = 'block';
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
    async function loadDashboard() {
      loadStats();
      loadUsers();
      loadProjects();
    }
    
    // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    async function loadStats() {
      const usersSnapshot = await firebase.firestore().collection('users').get();
      const projectsSnapshot = await firebase.firestore().collection('projects').get();
      const activeUsers = usersSnapshot.docs.filter(doc => doc.data().courseActive).length;
      
      document.getElementById('stats').innerHTML = `
        <div class="stat-card"><h3>${usersSnapshot.size}</h3><p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p></div>
        <div class="stat-card"><h3>${activeUsers}</h3><p>Ù…ÙØ¹Ù‘Ù„ÙŠÙ† Ø§Ù„ÙƒÙˆØ±Ø³</p></div>
        <div class="stat-card"><h3>${projectsSnapshot.size}</h3><p>Ù…Ø´Ø§Ø±ÙŠØ¹ Demo</p></div>
      `;
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    async function loadUsers() {
      const snapshot = await firebase.firestore().collection('users').get();
      const tbody = document.querySelector('#usersTable tbody');
      tbody.innerHTML = '';
      
      snapshot.forEach(doc => {
        const data = doc.data();
        const row = `
          <tr>
            <td>${data.email}</td>
            <td>${data.courseActive ? 'âœ…' : 'âŒ'}</td>
            <td>${data.isAdmin ? 'ğŸ‘‘' : 'ğŸ‘¤'}</td>
            <td>
              <button class="btn btn-success" onclick="toggleCourse('${doc.id}', ${!data.courseActive})" style="padding:5px 10px;font-size:12px;">
                ${data.courseActive ? 'Ø¥Ù„ØºØ§Ø¡' : 'ØªÙØ¹ÙŠÙ„'}
              </button>
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }
    
    // ØªØ¨Ø¯ÙŠÙ„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³
    async function toggleCourse(userId, active) {
      await firebase.firestore().collection('users').doc(userId).update({ courseActive: active });
      loadUsers();
      loadStats();
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
    async function loadProjects() {
      const snapshot = await firebase.firestore().collection('projects').get();
      const tbody = document.querySelector('#projectsTable tbody');
      tbody.innerHTML = '';
      
      snapshot.forEach(doc => {
        const data = doc.data();
        const row = `
          <tr>
            <td>${data.title}</td>
            <td>${data.desc}</td>
            <td><a href="${data.link}" target="_blank">Ø²ÙŠØ§Ø±Ø©</a></td>
            <td><button class="btn btn-danger" onclick="deleteProject('${doc.id}')" style="padding:5px 10px;font-size:12px;">Ø­Ø°Ù</button></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹
    async function addProject() {
      const title = document.getElementById('projectTitle').value;
      const desc = document.getElementById('projectDesc').value;
      const link = document.getElementById('projectLink').value;
      
      if (title && desc && link) {
        await firebase.firestore().collection('projects').add({ title, desc, link });
        document.getElementById('projectTitle').value = '';
        document.getElementById('projectDesc').value = '';
        document.getElementById('projectLink').value = '';
        loadProjects();
        loadStats();
      } else {
        alert('Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
      }
    }
    
    // Ø­Ø°Ù Ù…Ø´Ø±ÙˆØ¹
    async function deleteProject(id) {
      if (confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
        await firebase.firestore().collection('projects').doc(id).delete();
        loadProjects();
        loadStats();
      }
    }
  </script>
</body>
</html>
